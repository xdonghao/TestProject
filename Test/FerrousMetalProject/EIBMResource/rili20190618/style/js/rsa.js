// BigInt, a suite of routines for performing multiple-precision arithmetic in
// JavaScript.
//
// Copyright 1998-2005 David Shapiro.
//
// You may use, re-use, abuse,
// copy, and modify this code to your liking, but please keep this header.
// Thanks!
//
// Dave Shapiro
// dave@ohdave.com

// Copyright 2004-2005 David Shapiro.

(function(e,t){typeof define=="function"&&define.amd?define(["require","exports","module"],function(n,r,i){return t(e)}):typeof exports=="object"?module.exports=t(e):e.RSA=t(e)})(this,function(e){function p(e){f=e,l=new Array(f);for(var t=0;t<l.length;t++)l[t]=0;c=new m,h=new m,h.digits[0]=1}function m(e){typeof e=="boolean"&&e==1?this.digits=null:this.digits=l.slice(0),this.isNeg=!1}function g(e){var t=e.charAt(0)=="-",n=t?1:0,r;while(n<e.length&&e.charAt(n)=="0")++n;if(n==e.length)r=new m;else{var i=e.length-n,s=i%d;s==0&&(s=d),r=b(Number(e.substr(n,s))),n+=s;while(n<e.length)r=P(F(r,v),b(Number(e.substr(n,d)))),n+=d;r.isNeg=t}return r}function y(e){var t=new m(!0);return t.digits=e.digits.slice(0),t.isNeg=e.isNeg,t}function b(e){var t=new m;t.isNeg=e<0,e=Math.abs(e);var r=0;while(e>0)t.digits[r++]=e&u,e>>=n;return t}function w(e){var t="";for(var n=e.length-1;n>-1;--n)t+=e.charAt(n);return t}function S(e,t){var n=new m;n.digits[0]=t;var r=K(e,n),i=E[r[1].digits[0]];while(J(r[0],c)==1)r=K(r[0],n),digit=r[1].digits[0],i+=E[r[1].digits[0]];return(e.isNeg?"-":"")+w(i)}function x(e){var t=new m;t.digits[0]=10;var n=K(e,t),r=String(n[1].digits[0]);while(J(n[0],c)==1)n=K(n[0],t),r+=String(n[1].digits[0]);return(e.isNeg?"-":"")+w(r)}function N(e){var t=15,n="";for(var r=0;r<4;++r)n+=T[e&t],e>>>=4;return w(n)}function C(e){var t="",n=B(e);for(var r=B(e);r>-1;--r)t+=N(e.digits[r]);return t}function k(e){var t=48,n=t+9,r=97,i=r+25,s=65,o=90,u;return e>=t&&e<=n?u=e-t:e>=s&&e<=o?u=10+e-s:e>=r&&e<=i?u=10+e-r:u=0,u}function L(e){var t=0,n=Math.min(e.length,4);for(var r=0;r<n;++r)t<<=4,t|=k(e.charCodeAt(r));return t}function A(e){var t=new m,n=e.length;for(var r=n,i=0;r>0;r-=4,++i)t.digits[i]=L(e.substr(Math.max(r-4,0),Math.min(r,4)));return t}function O(e,t){var n=e.charAt(0)=="-",r=n?1:0,i=new m,s=new m;s.digits[0]=1;for(var o=e.length-1;o>=r;o--){var u=e.charCodeAt(o),a=k(u),f=I(s,a);i=P(i,f),s=I(s,t)}return i.isNeg=n,i}function M(e){var t="";for(var n=B(e);n>-1;--n)t+=_(e.digits[n]);return t}function _(e){var t=String.fromCharCode(e&255);e>>>=8;var n=String.fromCharCode(e&255);return n+t}function D(e){return(e.isNeg?"-":"")+e.digits.join(" ")}function P(e,t){var n;if(e.isNeg!=t.isNeg)t.isNeg=!t.isNeg,n=H(e,t),t.isNeg=!t.isNeg;else{n=new m;var r=0,s;for(var o=0;o<e.digits.length;++o)s=e.digits[o]+t.digits[o]+r,n.digits[o]=s&65535,r=Number(s>=i);n.isNeg=e.isNeg}return n}function H(e,t){var n;if(e.isNeg!=t.isNeg)t.isNeg=!t.isNeg,n=P(e,t),t.isNeg=!t.isNeg;else{n=new m;var r,s;s=0;for(var o=0;o<e.digits.length;++o)r=e.digits[o]-t.digits[o]+s,n.digits[o]=r&65535,n.digits[o]<0&&(n.digits[o]+=i),s=0-Number(r<0);if(s==-1){s=0;for(var o=0;o<e.digits.length;++o)r=0-n.digits[o]+s,n.digits[o]=r&65535,n.digits[o]<0&&(n.digits[o]+=i),s=0-Number(r<0);n.isNeg=!e.isNeg}else n.isNeg=e.isNeg}return n}function B(e){var t=e.digits.length-1;while(t>0&&e.digits[t]==0)--t;return t}function j(e){var t=B(e),n=e.digits[t],i=(t+1)*r,s;for(s=i;s>i-r;--s){if((n&32768)!=0)break;n<<=1}return s}function F(e,t){var r=new m,i,s=B(e),o=B(t),a,f,l;for(var c=0;c<=o;++c){i=0,l=c;for(var h=0;h<=s;++h,++l)f=r.digits[l]+e.digits[h]*t.digits[c]+i,r.digits[l]=f&u,i=f>>>n;r.digits[c+s+1]=i}return r.isNeg=e.isNeg!=t.isNeg,r}function I(e,t){var r,i,s,o=new m;r=B(e),i=0;for(var a=0;a<=r;++a)s=o.digits[a]+e.digits[a]*t+i,o.digits[a]=s&u,i=s>>>n;return o.digits[1+r]=i,o}function q(e,t,n,r,i){var s=Math.min(t+i,e.length);for(var o=t,u=r;o<s;++o,++u)n[u]=e[o]}function U(e,t){var n=Math.floor(t/r),i=new m;q(e.digits,0,i.digits,n,i.digits.length-n);var s=t%r,o=r-s;for(var a=i.digits.length-1,f=a-1;a>0;--a,--f)i.digits[a]=i.digits[a]<<s&u|(i.digits[f]&R[s])>>>o;return i.digits[0]=i.digits[a]<<s&u,i.isNeg=e.isNeg,i}function W(e,t){var n=Math.floor(t/r),i=new m;q(e.digits,n,i.digits,0,e.digits.length-n);var s=t%r,o=r-s;for(var u=0,a=u+1;u<i.digits.length-1;++u,++a)i.digits[u]=i.digits[u]>>>s|(i.digits[a]&z[s])<<o;return i.digits[i.digits.length-1]>>>=s,i.isNeg=e.isNeg,i}function X(e,t){var n=new m;return q(e.digits,0,n.digits,t,n.digits.length-t),n}function V(e,t){var n=new m;return q(e.digits,t,n.digits,0,n.digits.length-t),n}function $(e,t){var n=new m;return q(e.digits,0,n.digits,0,t),n}function J(e,t){if(e.isNeg!=t.isNeg)return 1-2*Number(e.isNeg);for(var n=e.digits.length-1;n>=0;--n)if(e.digits[n]!=t.digits[n])return e.isNeg?1-2*Number(e.digits[n]>t.digits[n]):1-2*Number(e.digits[n]<t.digits[n]);return 0}function K(e,t){var n=j(e),a=j(t),f=t.isNeg,l,c;if(n<a)return e.isNeg?(l=y(h),l.isNeg=!t.isNeg,e.isNeg=!1,t.isNeg=!1,c=H(t,e),e.isNeg=!0,t.isNeg=f):(l=new m,c=y(e)),new Array(l,c);l=new m,c=e;var p=Math.ceil(a/r)-1,d=0;while(t.digits[p]<s)t=U(t,1),++d,++a,p=Math.ceil(a/r)-1;c=U(c,d),n+=d;var v=Math.ceil(n/r)-1,g=X(t,v-p);while(J(c,g)!=-1)++l.digits[v-p],c=H(c,g);for(var b=v;b>p;--b){var w=b>=c.digits.length?0:c.digits[b],E=b-1>=c.digits.length?0:c.digits[b-1],S=b-2>=c.digits.length?0:c.digits[b-2],x=p>=t.digits.length?0:t.digits[p],T=p-1>=t.digits.length?0:t.digits[p-1];w==x?l.digits[b-p-1]=u:l.digits[b-p-1]=Math.floor((w*i+E)/x);var N=l.digits[b-p-1]*(x*i+T),C=w*o+(E*i+S);while(N>C)--l.digits[b-p-1],N=l.digits[b-p-1]*(x*i|T),C=w*i*i+(E*i+S);g=X(t,b-p-1),c=H(c,I(g,l.digits[b-p-1])),c.isNeg&&(c=P(c,g),--l.digits[b-p-1])}return c=W(c,d),l.isNeg=e.isNeg!=f,e.isNeg&&(f?l=P(l,h):l=H(l,h),t=W(t,d),c=H(t,c)),c.digits[0]==0&&B(c)==0&&(c.isNeg=!1),new Array(l,c)}function Q(e,t){return K(e,t)[0]}function G(e,t){return K(e,t)[1]}function Y(e,t,n){return G(F(e,t),n)}function Z(e,t){var n=h,r=e;for(;;){(t&1)!=0&&(n=F(n,r)),t>>=1;if(t==0)break;r=F(r,r)}return n}function et(e,t,n){var r=h,i=e,s=t;for(;;){(s.digits[0]&1)!=0&&(r=Y(r,i,n)),s=W(s,1);if(s.digits[0]==0&&B(s)==0)break;i=Y(i,i,n)}return r}function tt(e){this.modulus=y(e),this.k=B(this.modulus)+1;var t=new m;t.digits[2*this.k]=1,this.mu=Q(t,this.modulus),this.bkplus1=new m,this.bkplus1.digits[this.k+1]=1,this.modulo=nt,this.multiplyMod=rt,this.powMod=it}function nt(e){var t=V(e,this.k-1),n=F(t,this.mu),r=V(n,this.k+1),i=$(e,this.k+1),s=F(r,this.modulus),o=$(s,this.k+1),u=H(i,o);u.isNeg&&(u=P(u,this.bkplus1));var a=J(u,this.modulus)>=0;while(a)u=H(u,this.modulus),a=J(u,this.modulus)>=0;return u}function rt(e,t){var n=F(e,t);return this.modulo(n)}function it(e,t){var n=new m;n.digits[0]=1;var r=e,i=t;for(;;){(i.digits[0]&1)!=0&&(n=this.multiplyMod(n,r)),i=W(i,1);if(i.digits[0]==0&&B(i)==0)break;r=this.multiplyMod(r,r)}return n}function ot(e,t,n,r){this.e=A(e),this.d=A(t),this.m=A(n),typeof r!="number"?this.chunkSize=2*B(this.m):this.chunkSize=r/8,this.radix=16,this.barrett=new tt(this.m)}function ut(e,t,n,r){var i=new Array,s=t.length,o,u,a,f,l,c,h,p="",d,v,g;typeof n=="string"?n==st.NoPadding?f=1:n==st.PKCS1Padding?f=2:f=0:f=0,typeof r=="string"&&r==st.RawEncoding?l=1:l=0,f==1?s>e.chunkSize&&(s=e.chunkSize):f==2&&s>e.chunkSize-11&&(s=e.chunkSize-11),o=0,f==2?u=s-1:u=e.chunkSize-1;while(o<s)f?i[u]=t.charCodeAt(o):i[o]=t.charCodeAt(o),o++,u--;f==1&&(o=0),u=e.chunkSize-s%e.chunkSize;while(u>0){if(f==2){c=Math.floor(Math.random()*256);while(!c)c=Math.floor(Math.random()*256);i[o]=c}else i[o]=0;o++,u--}f==2&&(i[s]=0,i[e.chunkSize-2]=2,i[e.chunkSize-1]=0),h=i.length;for(o=0;o<h;o+=e.chunkSize){d=new m,u=0;for(a=o;a<o+e.chunkSize;++u)d.digits[u]=i[a++],d.digits[u]+=i[a++]<<8;v=e.barrett.powMod(d,e.e),l==1?g=M(v):g=e.radix==16?C(v):S(v,e.radix),p+=g}return p}function at(e,t){var n=t.split(" "),r,i,s,o,u="";for(i=0;i<n.length;++i){e.radix==16?o=A(n[i]):o=O(n[i],e.radix),r=e.barrett.powMod(o,e.d);for(s=0;s<=B(r);++s)u+=String.fromCharCode(r.digits[s]&255,r.digits[s]>>8)}return u.charCodeAt(u.length-1)==0&&(u=u.substring(0,u.length-1)),u}var t=2,n=16,r=n,i=65536,s=i>>>1,o=i*i,u=i-1,a=9999999999999998,f,l,c,h;p(20);var d=15,v=b(1e15),E=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"),T=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),R=new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535),z=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535),st={};return st.NoPadding="NoPadding",st.PKCS1Padding="PKCS1Padding",st.RawEncoding="RawEncoding",st.NumericEncoding="NumericEncoding",{rsa_n:"B767C1C88EF56E4CE35A13C8A567F7B47D85125E7D1A5EE33131C5E1C91DDC535CA2D1D7A5C18F13A4850BA3980D3685452489C4BF1784BFBD7488512992DFE19306BE9C3591BB4C80A7FB2E850A5AB1D81D1354436561BB9E0B6A545488E71CAC20449664BDDD29CFD0D439D8DEBC2D07C6EF1F42382F5C13B72607E4BCDB5B",setMaxDigits:p,encryptedString:ut,RSAKeyPair:ot}});